
<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta charset="utf-8" />
    <title>evennia.game_template.commands.command &#8212; Evennia 1.0-dev documentation</title>
    <link rel="stylesheet" href="../../../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../../../" src="../../../../_static/documentation_options.js"></script>
    <script src="../../../../_static/jquery.js"></script>
    <script src="../../../../_static/underscore.js"></script>
    <script src="../../../../_static/doctools.js"></script>
    <script src="../../../../_static/language_data.js"></script>
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">Evennia 1.0-dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../evennia.html" accesskey="U">evennia</a> &#187;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for evennia.game_template.commands.command</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Commands</span>

<span class="sd">Commands describe the input the account can do to the game.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">evennia</span> <span class="k">import</span> <span class="n">Command</span> <span class="k">as</span> <span class="n">BaseCommand</span>

<span class="c1"># from evennia import default_cmds</span>


<div class="viewcode-block" id="Command"><a class="viewcode-back" href="../../../../api/evennia.game_template.commands.html#evennia.game_template.commands.command.Command">[docs]</a><span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">BaseCommand</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inherit from this if you want to create your own command styles</span>
<span class="sd">    from scratch.  Note that Evennia&#39;s default commands inherits from</span>
<span class="sd">    MuxCommand instead.</span>

<span class="sd">    Note that the class&#39;s `__doc__` string (this text) is</span>
<span class="sd">    used by Evennia to create the automatic help entry for</span>
<span class="sd">    the command, so make sure to document consistently here.</span>

<span class="sd">    Each Command implements the following methods, called</span>
<span class="sd">    in this order (only func() is actually required):</span>
<span class="sd">        - at_pre_cmd(): If this returns anything truthy, execution is aborted.</span>
<span class="sd">        - parse(): Should perform any extra parsing needed on self.args</span>
<span class="sd">            and store the result on self.</span>
<span class="sd">        - func(): Performs the actual work.</span>
<span class="sd">        - at_post_cmd(): Extra actions, often things done after</span>
<span class="sd">            every command, like prompts.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">pass</span></div>


<span class="c1"># -------------------------------------------------------------</span>
<span class="c1">#</span>
<span class="c1"># The default commands inherit from</span>
<span class="c1">#</span>
<span class="c1">#   evennia.commands.default.muxcommand.MuxCommand.</span>
<span class="c1">#</span>
<span class="c1"># If you want to make sweeping changes to default commands you can</span>
<span class="c1"># uncomment this copy of the MuxCommand parent and add</span>
<span class="c1">#</span>
<span class="c1">#   COMMAND_DEFAULT_CLASS = &quot;commands.command.MuxCommand&quot;</span>
<span class="c1">#</span>
<span class="c1"># to your settings file. Be warned that the default commands expect</span>
<span class="c1"># the functionality implemented in the parse() method, so be</span>
<span class="c1"># careful with what you change.</span>
<span class="c1">#</span>
<span class="c1"># -------------------------------------------------------------</span>

<span class="c1"># from evennia.utils import utils</span>
<span class="c1">#</span>
<span class="c1">#</span>
<span class="c1"># class MuxCommand(Command):</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     This sets up the basis for a MUX command. The idea</span>
<span class="c1">#     is that most other Mux-related commands should just</span>
<span class="c1">#     inherit from this and don&#39;t have to implement much</span>
<span class="c1">#     parsing of their own unless they do something particularly</span>
<span class="c1">#     advanced.</span>
<span class="c1">#</span>
<span class="c1">#     Note that the class&#39;s __doc__ string (this text) is</span>
<span class="c1">#     used by Evennia to create the automatic help entry for</span>
<span class="c1">#     the command, so make sure to document consistently here.</span>
<span class="c1">#     &quot;&quot;&quot;</span>
<span class="c1">#     def has_perm(self, srcobj):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         This is called by the cmdhandler to determine</span>
<span class="c1">#         if srcobj is allowed to execute this command.</span>
<span class="c1">#         We just show it here for completeness - we</span>
<span class="c1">#         are satisfied using the default check in Command.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         return super().has_perm(srcobj)</span>
<span class="c1">#</span>
<span class="c1">#     def at_pre_cmd(self):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         This hook is called before self.parse() on all commands</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         pass</span>
<span class="c1">#</span>
<span class="c1">#     def at_post_cmd(self):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         This hook is called after the command has finished executing</span>
<span class="c1">#         (after self.func()).</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         pass</span>
<span class="c1">#</span>
<span class="c1">#     def parse(self):</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         This method is called by the cmdhandler once the command name</span>
<span class="c1">#         has been identified. It creates a new set of member variables</span>
<span class="c1">#         that can be later accessed from self.func() (see below)</span>
<span class="c1">#</span>
<span class="c1">#         The following variables are available for our use when entering this</span>
<span class="c1">#         method (from the command definition, and assigned on the fly by the</span>
<span class="c1">#         cmdhandler):</span>
<span class="c1">#            self.key - the name of this command (&#39;look&#39;)</span>
<span class="c1">#            self.aliases - the aliases of this cmd (&#39;l&#39;)</span>
<span class="c1">#            self.permissions - permission string for this command</span>
<span class="c1">#            self.help_category - overall category of command</span>
<span class="c1">#</span>
<span class="c1">#            self.caller - the object calling this command</span>
<span class="c1">#            self.cmdstring - the actual command name used to call this</span>
<span class="c1">#                             (this allows you to know which alias was used,</span>
<span class="c1">#                              for example)</span>
<span class="c1">#            self.args - the raw input; everything following self.cmdstring.</span>
<span class="c1">#            self.cmdset - the cmdset from which this command was picked. Not</span>
<span class="c1">#                          often used (useful for commands like &#39;help&#39; or to</span>
<span class="c1">#                          list all available commands etc)</span>
<span class="c1">#            self.obj - the object on which this command was defined. It is often</span>
<span class="c1">#                          the same as self.caller.</span>
<span class="c1">#</span>
<span class="c1">#         A MUX command has the following possible syntax:</span>
<span class="c1">#</span>
<span class="c1">#           name[ with several words][/switch[/switch..]] arg1[,arg2,...] [[=|,] arg[,..]]</span>
<span class="c1">#</span>
<span class="c1">#         The &#39;name[ with several words]&#39; part is already dealt with by the</span>
<span class="c1">#         cmdhandler at this point, and stored in self.cmdname (we don&#39;t use</span>
<span class="c1">#         it here). The rest of the command is stored in self.args, which can</span>
<span class="c1">#         start with the switch indicator /.</span>
<span class="c1">#</span>
<span class="c1">#         This parser breaks self.args into its constituents and stores them in the</span>
<span class="c1">#         following variables:</span>
<span class="c1">#           self.switches = [list of /switches (without the /)]</span>
<span class="c1">#           self.raw = This is the raw argument input, including switches</span>
<span class="c1">#           self.args = This is re-defined to be everything *except* the switches</span>
<span class="c1">#           self.lhs = Everything to the left of = (lhs:&#39;left-hand side&#39;). If</span>
<span class="c1">#                      no = is found, this is identical to self.args.</span>
<span class="c1">#           self.rhs: Everything to the right of = (rhs:&#39;right-hand side&#39;).</span>
<span class="c1">#                     If no &#39;=&#39; is found, this is None.</span>
<span class="c1">#           self.lhslist - [self.lhs split into a list by comma]</span>
<span class="c1">#           self.rhslist - [list of self.rhs split into a list by comma]</span>
<span class="c1">#           self.arglist = [list of space-separated args (stripped, including &#39;=&#39; if it exists)]</span>
<span class="c1">#</span>
<span class="c1">#           All args and list members are stripped of excess whitespace around the</span>
<span class="c1">#           strings, but case is preserved.</span>
<span class="c1">#         &quot;&quot;&quot;</span>
<span class="c1">#         raw = self.args</span>
<span class="c1">#         args = raw.strip()</span>
<span class="c1">#</span>
<span class="c1">#         # split out switches</span>
<span class="c1">#         switches = []</span>
<span class="c1">#         if args and len(args) &gt; 1 and args[0] == &quot;/&quot;:</span>
<span class="c1">#             # we have a switch, or a set of switches. These end with a space.</span>
<span class="c1">#             switches = args[1:].split(None, 1)</span>
<span class="c1">#             if len(switches) &gt; 1:</span>
<span class="c1">#                 switches, args = switches</span>
<span class="c1">#                 switches = switches.split(&#39;/&#39;)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 args = &quot;&quot;</span>
<span class="c1">#                 switches = switches[0].split(&#39;/&#39;)</span>
<span class="c1">#         arglist = [arg.strip() for arg in args.split()]</span>
<span class="c1">#</span>
<span class="c1">#         # check for arg1, arg2, ... = argA, argB, ... constructs</span>
<span class="c1">#         lhs, rhs = args, None</span>
<span class="c1">#         lhslist, rhslist = [arg.strip() for arg in args.split(&#39;,&#39;)], []</span>
<span class="c1">#         if args and &#39;=&#39; in args:</span>
<span class="c1">#             lhs, rhs = [arg.strip() for arg in args.split(&#39;=&#39;, 1)]</span>
<span class="c1">#             lhslist = [arg.strip() for arg in lhs.split(&#39;,&#39;)]</span>
<span class="c1">#             rhslist = [arg.strip() for arg in rhs.split(&#39;,&#39;)]</span>
<span class="c1">#</span>
<span class="c1">#         # save to object properties:</span>
<span class="c1">#         self.raw = raw</span>
<span class="c1">#         self.switches = switches</span>
<span class="c1">#         self.args = args.strip()</span>
<span class="c1">#         self.arglist = arglist</span>
<span class="c1">#         self.lhs = lhs</span>
<span class="c1">#         self.lhslist = lhslist</span>
<span class="c1">#         self.rhs = rhs</span>
<span class="c1">#         self.rhslist = rhslist</span>
<span class="c1">#</span>
<span class="c1">#         # if the class has the account_caller property set on itself, we make</span>
<span class="c1">#         # sure that self.caller is always the account if possible. We also create</span>
<span class="c1">#         # a special property &quot;character&quot; for the puppeted object, if any. This</span>
<span class="c1">#         # is convenient for commands defined on the Account only.</span>
<span class="c1">#         if hasattr(self, &quot;account_caller&quot;) and self.account_caller:</span>
<span class="c1">#             if utils.inherits_from(self.caller, &quot;evennia.objects.objects.DefaultObject&quot;):</span>
<span class="c1">#                 # caller is an Object/Character</span>
<span class="c1">#                 self.character = self.caller</span>
<span class="c1">#                 self.caller = self.caller.account</span>
<span class="c1">#             elif utils.inherits_from(self.caller, &quot;evennia.accounts.accounts.DefaultAccount&quot;):</span>
<span class="c1">#                 # caller was already an Account</span>
<span class="c1">#                 self.character = self.caller.get_puppet(self.session)</span>
<span class="c1">#             else:</span>
<span class="c1">#                 self.character = None</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../../../index.html">
              <img class="logo" src="../../../../_static/evennia_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h3>Versions</h3>
<ul>
  <li><a href="command.html">1.0-dev (develop branch)</a></li>
  <li><a href="../../../../../0.9.1/index.html">0.9.1 (master branch)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../../index.html">Evennia 1.0-dev documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../../../evennia.html" >evennia</a> &#187;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, The Evennia developer community.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 2.4.4.
    </div>
  </body>
</html>