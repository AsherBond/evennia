

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>evennia.contrib.ingame_python.typeclasses &mdash; Evennia 1.0-dev documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="../../../../genindex.html"/>
        <link rel="search" title="Search" href="../../../../search.html"/>
    <link rel="top" title="Evennia 1.0-dev documentation" href="../../../../index.html"/>
        <link rel="up" title="evennia" href="../../../evennia.html"/> 

  
  <script src="../../../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../../../index.html" class="icon icon-home"> Evennia
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <!-- Local TOC -->
                <div class="local-toc"></div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Evennia</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../../../index.html">Module code</a> &raquo;</li>
        
          <li><a href="../../../evennia.html">evennia</a> &raquo;</li>
        
      <li>evennia.contrib.ingame_python.typeclasses</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for evennia.contrib.ingame_python.typeclasses</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Typeclasses for the in-game Python system.</span>

<span class="sd">To use them, change your base typeclasses to inherit from the classes in this</span>
<span class="sd">module (EventObject, EventRoom, EventCharacter and EventExit) instead of the</span>
<span class="sd">default ones in evennia core.</span>

<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">evennia</span> <span class="k">import</span> <span class="n">DefaultCharacter</span><span class="p">,</span> <span class="n">DefaultExit</span><span class="p">,</span> <span class="n">DefaultObject</span><span class="p">,</span> <span class="n">DefaultRoom</span>
<span class="kn">from</span> <span class="nn">evennia</span> <span class="k">import</span> <span class="n">ScriptDB</span>
<span class="kn">from</span> <span class="nn">evennia.utils.utils</span> <span class="k">import</span> <span class="n">delay</span><span class="p">,</span> <span class="n">inherits_from</span><span class="p">,</span> <span class="n">lazy_property</span>
<span class="kn">from</span> <span class="nn">evennia.contrib.ingame_python.callbackhandler</span> <span class="k">import</span> <span class="n">CallbackHandler</span>
<span class="kn">from</span> <span class="nn">evennia.contrib.ingame_python.utils</span> <span class="k">import</span> <span class="n">register_events</span><span class="p">,</span> <span class="n">time_event</span><span class="p">,</span> <span class="n">phrase_event</span>

<span class="c1"># Character help</span>
<span class="n">CHARACTER_CAN_DELETE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Can the character be deleted?</span>
<span class="s2">This event is called before the character is deleted.  You can use</span>
<span class="s2">&#39;deny()&#39; in this event to prevent this character from being deleted.</span>
<span class="s2">If this event doesn&#39;t prevent the character from being deleted, its</span>
<span class="s2">&#39;delete&#39; event is called right away.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_CAN_MOVE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Can the character move?</span>
<span class="s2">This event is called before the character moves into another</span>
<span class="s2">location.  You can prevent the character from moving</span>
<span class="s2">using the &#39;deny()&#39; eventfunc.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">    origin: the current location of the character.</span>
<span class="s2">    destination: the future location of the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_CAN_PART</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Can the departing charaacter leave this room?</span>
<span class="s2">This event is called before another character can move from the</span>
<span class="s2">location where the current character also is.  This event can be</span>
<span class="s2">used to prevent someone to leave this room if, for instance, he/she</span>
<span class="s2">hasn&#39;t paid, or he/she is going to a protected area, past a guard,</span>
<span class="s2">and so on.  Use &#39;deny()&#39; to prevent the departing character from</span>
<span class="s2">moving.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    departing: the character who wants to leave this room.</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_CAN_SAY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Before another character can say something in the same location.</span>
<span class="s2">This event is called before another character says something in the</span>
<span class="s2">character&#39;s location.  The &quot;something&quot; in question can be modified,</span>
<span class="s2">or the action can be prevented by using &#39;deny()&#39;.  To change the</span>
<span class="s2">content of what the character says, simply change the variable</span>
<span class="s2">&#39;message&#39; to another string of characters.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    speaker: the character who is using the say command.</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">    message: the text spoken by the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_DELETE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Before deleting the character.</span>
<span class="s2">This event is called just before deleting this character.  It shouldn&#39;t</span>
<span class="s2">be prevented (using the `deny()` function at this stage doesn&#39;t</span>
<span class="s2">have any effect).  If you want to prevent deletion of this character,</span>
<span class="s2">use the event `can_delete` instead.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_GREET</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">A new character arrives in the location of this character.</span>
<span class="s2">This event is called when another character arrives in the location</span>
<span class="s2">where the current character is.  For instance, a puppeted character</span>
<span class="s2">arrives in the shop of a shopkeeper (assuming the shopkeeper is</span>
<span class="s2">a character).  As its name suggests, this event can be very useful</span>
<span class="s2">to have NPC greeting one another, or accounts, who come to visit.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">    newcomer: the character arriving in the same location.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_MOVE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">After the character has moved into its new room.</span>
<span class="s2">This event is called when the character has moved into a new</span>
<span class="s2">room.  It is too late to prevent the move at this point.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">    origin: the old location of the character.</span>
<span class="s2">    destination: the new location of the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_PUPPETED</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">When the character has been puppeted by an account.</span>
<span class="s2">This event is called when an account has just puppeted this character.</span>
<span class="s2">This can commonly happen when an account connects onto this character,</span>
<span class="s2">or when puppeting to a NPC or free character.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_SAY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">After another character has said something in the character&#39;s room.</span>
<span class="s2">This event is called right after another character has said</span>
<span class="s2">something in the same location..  The action cannot be prevented</span>
<span class="s2">at this moment.  Instead, this event is ideal to create keywords</span>
<span class="s2">that would trigger a character (like a NPC) in doing something</span>
<span class="s2">if a specific phrase is spoken in the same location.</span>
<span class="s2">To use this event, you have to specify a list of keywords as</span>
<span class="s2">parameters that should be present, as separate words, in the</span>
<span class="s2">spoken phrase.  For instance, you can set an event tthat would</span>
<span class="s2">fire if the phrase spoken by the character contains &quot;menu&quot; or</span>
<span class="s2">&quot;dinner&quot; or &quot;lunch&quot;:</span>
<span class="s2">    @call/add ... = say menu, dinner, lunch</span>
<span class="s2">Then if one of the words is present in what the character says,</span>
<span class="s2">this event will fire.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    speaker: the character speaking in this room.</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">    message: the text having been spoken by the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_TIME</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">A repeated event to be called regularly.</span>
<span class="s2">This event is scheduled to repeat at different times, specified</span>
<span class="s2">as parameters.  You can set it to run every day at 8:00 AM (game</span>
<span class="s2">time).  You have to specify the time as an argument to @call/add, like:</span>
<span class="s2">    @call/add here = time 8:00</span>
<span class="s2">The parameter (8:00 here) must be a suite of digits separated by</span>
<span class="s2">spaces, colons or dashes.  Keep it as close from a recognizable</span>
<span class="s2">date format, like this:</span>
<span class="s2">    @call/add here = time 06-15 12:20</span>
<span class="s2">This event will fire every year on June the 15th at 12 PM (still</span>
<span class="s2">game time).  Units have to be specified depending on your set calendar</span>
<span class="s2">(ask a developer for more details).</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">CHARACTER_UNPUPPETED</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">When the character is about to be un-puppeted.</span>
<span class="s2">This event is called when an account is about to un-puppet the</span>
<span class="s2">character, which can happen if the account is disconnecting or</span>
<span class="s2">changing puppets.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="EventCharacter"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter">[docs]</a><span class="nd">@register_events</span>
<span class="k">class</span> <span class="nc">EventCharacter</span><span class="p">(</span><span class="n">DefaultCharacter</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Typeclass to represent a character and call event types.&quot;&quot;&quot;</span>

    <span class="n">_events</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;can_delete&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">],</span> <span class="n">CHARACTER_CAN_DELETE</span><span class="p">),</span>
        <span class="s2">&quot;can_move&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">CHARACTER_CAN_MOVE</span><span class="p">),</span>
        <span class="s2">&quot;can_part&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;departing&quot;</span><span class="p">],</span> <span class="n">CHARACTER_CAN_PART</span><span class="p">),</span>
        <span class="s2">&quot;can_say&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;speaker&quot;</span><span class="p">,</span> <span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">CHARACTER_CAN_SAY</span><span class="p">,</span> <span class="n">phrase_event</span><span class="p">),</span>
        <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">],</span> <span class="n">CHARACTER_DELETE</span><span class="p">),</span>
        <span class="s2">&quot;greet&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;newcomer&quot;</span><span class="p">],</span> <span class="n">CHARACTER_GREET</span><span class="p">),</span>
        <span class="s2">&quot;move&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">CHARACTER_MOVE</span><span class="p">),</span>
        <span class="s2">&quot;puppeted&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">],</span> <span class="n">CHARACTER_PUPPETED</span><span class="p">),</span>
        <span class="s2">&quot;say&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;speaker&quot;</span><span class="p">,</span> <span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">CHARACTER_SAY</span><span class="p">,</span> <span class="n">phrase_event</span><span class="p">),</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">],</span> <span class="n">CHARACTER_TIME</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_event</span><span class="p">),</span>
        <span class="s2">&quot;unpuppeted&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">],</span> <span class="n">CHARACTER_UNPUPPETED</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="EventCharacter.callbacks"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.callbacks">[docs]</a>    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the CallbackHandler.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CallbackHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventCharacter.announce_move_from"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.announce_move_from">[docs]</a>    <span class="k">def</span> <span class="nf">announce_move_from</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called if the move is to be announced. This is</span>
<span class="sd">        called while we are still standing in the old</span>
<span class="sd">        location.</span>

<span class="sd">        Args:</span>
<span class="sd">            destination (Object): The place we are going to.</span>
<span class="sd">            msg (str, optional): a replacement message.</span>
<span class="sd">            mapping (dict, optional): additional mapping objects.</span>

<span class="sd">        You can override this method and call its parent with a</span>
<span class="sd">        message to simply change the default message.  In the string,</span>
<span class="sd">        you can use the following as mappings (between braces):</span>
<span class="sd">            object: the object which is moving.</span>
<span class="sd">            exit: the exit from which the object is moving (if found).</span>
<span class="sd">            origin: the location of the object before the move.</span>
<span class="sd">            destination: the location of the object after moving.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">string</span> <span class="o">=</span> <span class="n">msg</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{object}</span><span class="s2"> is leaving </span><span class="si">{origin}</span><span class="s2">, heading for </span><span class="si">{destination}</span><span class="s2">.&quot;</span>

        <span class="c1"># Get the exit from location to destination</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="n">exits</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">location</span> <span class="ow">is</span> <span class="n">location</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">destination</span> <span class="ow">is</span> <span class="n">destination</span>
        <span class="p">]</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">mapping</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;character&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">exits</span><span class="p">:</span>
            <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
                <span class="s2">&quot;msg_leave&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">location</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">mapping</span>
            <span class="p">)</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
            <span class="n">mapping</span> <span class="o">=</span> <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;mapping&quot;</span><span class="p">)</span>

        <span class="c1"># If there&#39;s no string, don&#39;t display anything</span>
        <span class="c1"># It can happen if the &quot;message&quot; variable in events is set to None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">announce_move_from</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventCharacter.announce_move_to"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.announce_move_to">[docs]</a>    <span class="k">def</span> <span class="nf">announce_move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_location</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after the move if the move was not quiet. At this point</span>
<span class="sd">        we are standing in the new location.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_location (Object): The place we came from</span>
<span class="sd">            msg (str, optional): the replacement message if location.</span>
<span class="sd">            mapping (dict, optional): additional mapping objects.</span>

<span class="sd">        You can override this method and call its parent with a</span>
<span class="sd">        message to simply change the default message.  In the string,</span>
<span class="sd">        you can use the following as mappings (between braces):</span>
<span class="sd">            object: the object which is moving.</span>
<span class="sd">            exit: the exit from which the object is moving (if found).</span>
<span class="sd">            origin: the location of the object before the move.</span>
<span class="sd">            destination: the location of the object after moving.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">source_location</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">has_account</span><span class="p">:</span>
            <span class="c1"># This was created from nowhere and added to an account&#39;s</span>
            <span class="c1"># inventory; it&#39;s probably the result of a create command.</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;You now have </span><span class="si">%s</span><span class="s2"> in your possession.&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_display_name</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="o">.</span><span class="n">msg</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">source_location</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="n">msg</span> <span class="ow">or</span> <span class="s2">&quot;</span><span class="si">{character}</span><span class="s2"> arrives to </span><span class="si">{destination}</span><span class="s2"> from </span><span class="si">{origin}</span><span class="s2">.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{character}</span><span class="s2"> arrives to </span><span class="si">{destination}</span><span class="s2">.&quot;</span>

        <span class="n">origin</span> <span class="o">=</span> <span class="n">source_location</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="n">exits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mapping</span> <span class="o">=</span> <span class="n">mapping</span> <span class="ow">or</span> <span class="p">{}</span>
        <span class="n">mapping</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;character&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">})</span>

        <span class="k">if</span> <span class="n">origin</span><span class="p">:</span>
            <span class="n">exits</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">o</span>
                <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">destination</span><span class="o">.</span><span class="n">contents</span>
                <span class="k">if</span> <span class="n">o</span><span class="o">.</span><span class="n">location</span> <span class="ow">is</span> <span class="n">destination</span> <span class="ow">and</span> <span class="n">o</span><span class="o">.</span><span class="n">destination</span> <span class="ow">is</span> <span class="n">origin</span>
            <span class="p">]</span>
            <span class="k">if</span> <span class="n">exits</span><span class="p">:</span>
                <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
                    <span class="s2">&quot;msg_arrive&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">mapping</span>
                <span class="p">)</span>
                <span class="n">string</span> <span class="o">=</span> <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
                <span class="n">mapping</span> <span class="o">=</span> <span class="n">exits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;mapping&quot;</span><span class="p">)</span>

        <span class="c1"># If there&#39;s no string, don&#39;t display anything</span>
        <span class="c1"># It can happen if the &quot;message&quot; variable in events is set to None</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">string</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">announce_move_to</span><span class="p">(</span><span class="n">source_location</span><span class="p">,</span> <span class="n">msg</span><span class="o">=</span><span class="n">string</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="n">mapping</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventCharacter.at_before_move"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_before_move">[docs]</a>    <span class="k">def</span> <span class="nf">at_before_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">destination</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called just before starting to move this object to</span>
<span class="sd">        destination.</span>

<span class="sd">        Args:</span>
<span class="sd">            destination (Object): The object we are moving to</span>

<span class="sd">        Returns:</span>
<span class="sd">            shouldmove (bool): If we should move or not.</span>

<span class="sd">        Notes:</span>
<span class="sd">            If this method returns False/None, the move is cancelled</span>
<span class="sd">            before it is even started.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">origin</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="n">Room</span> <span class="o">=</span> <span class="n">DefaultRoom</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">Room</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">Room</span><span class="p">):</span>
            <span class="n">can</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">can</span><span class="p">:</span>
                <span class="n">can</span> <span class="o">=</span> <span class="n">origin</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">can</span><span class="p">:</span>
                    <span class="c1"># Call other character&#39;s &#39;can_part&#39; event</span>
                    <span class="k">for</span> <span class="n">present</span> <span class="ow">in</span> <span class="p">[</span>
                        <span class="n">o</span>
                        <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">origin</span><span class="o">.</span><span class="n">contents</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">DefaultCharacter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span>
                    <span class="p">]:</span>
                        <span class="n">can</span> <span class="o">=</span> <span class="n">present</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_part&quot;</span><span class="p">,</span> <span class="n">present</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
                        <span class="k">if</span> <span class="ow">not</span> <span class="n">can</span><span class="p">:</span>
                            <span class="k">break</span>

            <span class="k">if</span> <span class="n">can</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="k">return</span> <span class="n">can</span>

        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="EventCharacter.at_after_move"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_after_move">[docs]</a>    <span class="k">def</span> <span class="nf">at_after_move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called after move has completed, regardless of quiet mode or</span>
<span class="sd">        not.  Allows changes to the object due to the location it is</span>
<span class="sd">        now in.</span>

<span class="sd">        Args:</span>
<span class="sd">            source_location (Object): Wwhere we came from. This may be `None`.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_after_move</span><span class="p">(</span><span class="n">source_location</span><span class="p">)</span>

        <span class="n">origin</span> <span class="o">=</span> <span class="n">source_location</span>
        <span class="n">destination</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="n">Room</span> <span class="o">=</span> <span class="n">DefaultRoom</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">origin</span><span class="p">,</span> <span class="n">Room</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">destination</span><span class="p">,</span> <span class="n">Room</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>
            <span class="n">destination</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;move&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">origin</span><span class="p">,</span> <span class="n">destination</span><span class="p">)</span>

            <span class="c1"># Call the &#39;greet&#39; event of characters in the location</span>
            <span class="k">for</span> <span class="n">present</span> <span class="ow">in</span> <span class="p">[</span>
                <span class="n">o</span> <span class="k">for</span> <span class="n">o</span> <span class="ow">in</span> <span class="n">destination</span><span class="o">.</span><span class="n">contents</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">o</span><span class="p">,</span> <span class="n">DefaultCharacter</span><span class="p">)</span> <span class="ow">and</span> <span class="n">o</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span>
            <span class="p">]:</span>
                <span class="n">present</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;greet&quot;</span><span class="p">,</span> <span class="n">present</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventCharacter.at_object_delete"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_object_delete">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called just before the database object is permanently</span>
<span class="sd">        delete()d from the database. If this method returns False,</span>
<span class="sd">        deletion is aborted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_delete&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div>

<div class="viewcode-block" id="EventCharacter.at_post_puppet"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_post_puppet">[docs]</a>    <span class="k">def</span> <span class="nf">at_post_puppet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called just after puppeting has been completed and all</span>
<span class="sd">        Account&lt;-&gt;Object links have been established.</span>

<span class="sd">        Note:</span>
<span class="sd">            You can use `self.account` and `self.sessions.get()` to get</span>
<span class="sd">            account and sessions at this point; the last entry in the</span>
<span class="sd">            list from `self.sessions.get()` is the latest Session</span>
<span class="sd">            puppeting this Object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_post_puppet</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;puppeted&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Call the room&#39;s puppeted_in event</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">DefaultRoom</span><span class="p">):</span>
            <span class="n">location</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;puppeted_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventCharacter.at_pre_unpuppet"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_pre_unpuppet">[docs]</a>    <span class="k">def</span> <span class="nf">at_pre_unpuppet</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called just before beginning to un-connect a puppeting from</span>
<span class="sd">        this Account.</span>

<span class="sd">        Note:</span>
<span class="sd">            You can use `self.account` and `self.sessions.get()` to get</span>
<span class="sd">            account and sessions at this point; the last entry in the</span>
<span class="sd">            list from `self.sessions.get()` is the latest Session</span>
<span class="sd">            puppeting this Object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;unpuppeted&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>

        <span class="c1"># Call the room&#39;s unpuppeted_in event</span>
        <span class="n">location</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">DefaultRoom</span><span class="p">):</span>
            <span class="n">location</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;unpuppeted_in&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">)</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_pre_unpuppet</span><span class="p">()</span></div>

<div class="viewcode-block" id="EventCharacter.at_before_say"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_before_say">[docs]</a>    <span class="k">def</span> <span class="nf">at_before_say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Before the object says something.</span>

<span class="sd">        This hook is by default used by the &#39;say&#39; and &#39;whisper&#39;</span>
<span class="sd">        commands as used by this command it is called before the text</span>
<span class="sd">        is said/whispered and can be used to customize the outgoing</span>
<span class="sd">        text from the object. Returning `None` aborts the command.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (str): The suggested say/whisper text spoken by self.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            whisper (bool): If True, this is a whisper rather than</span>
<span class="sd">                a say. This is sent by the whisper command by default.</span>
<span class="sd">                Other verbal commands could use this hook in similar</span>
<span class="sd">                ways.</span>
<span class="sd">            receiver (Object): If set, this is a target for the say/whisper.</span>

<span class="sd">        Returns:</span>
<span class="sd">            message (str): The (possibly modified) text to be spoken.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># First, try the location</span>
        <span class="n">location</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">location</span>
            <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="n">inherits_from</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s2">&quot;evennia.objects.objects.DefaultRoom&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;whisper&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">allow</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_say&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">location</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
                <span class="k">return</span>

            <span class="c1"># Browse all the room&#39;s other characters</span>
            <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">contents</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="bp">self</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">inherits_from</span><span class="p">(</span>
                    <span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;evennia.objects.objects.DefaultCharacter&quot;</span>
                <span class="p">):</span>
                    <span class="k">continue</span>

                <span class="n">allow</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_say&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">get_variable</span><span class="p">(</span><span class="s2">&quot;message&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">allow</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">message</span><span class="p">:</span>
                    <span class="k">return</span>

        <span class="k">return</span> <span class="n">message</span></div>

<div class="viewcode-block" id="EventCharacter.at_say"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventCharacter.at_say">[docs]</a>    <span class="k">def</span> <span class="nf">at_say</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Display the actual say (or whisper) of self.</span>

<span class="sd">        This hook should display the actual say/whisper of the object in its</span>
<span class="sd">        location.  It should both alert the object (self) and its</span>
<span class="sd">        location that some text is spoken.  The overriding of messages or</span>
<span class="sd">        `mapping` allows for simple customization of the hook without</span>
<span class="sd">        re-writing it completely.</span>

<span class="sd">        Args:</span>
<span class="sd">            message (str): The text to be conveyed by self.</span>
<span class="sd">            msg_self (str, optional): The message to echo to self.</span>
<span class="sd">            msg_location (str, optional): The message to echo to self&#39;s location.</span>
<span class="sd">            receiver (Object, optional): An eventual receiver of the message</span>
<span class="sd">                (by default only used by whispers).</span>
<span class="sd">            msg_receiver(str, optional): Specific message for receiver only.</span>
<span class="sd">            mapping (dict, optional): Additional mapping in messages.</span>
<span class="sd">        Kwargs:</span>
<span class="sd">            whisper (bool): If this is a whisper rather than a say. Kwargs</span>
<span class="sd">                can be used by other verbal commands in a similar way.</span>

<span class="sd">        Notes:</span>

<span class="sd">            Messages can contain {} markers, which must</span>
<span class="sd">            If used, `msg_self`, `msg_receiver`  and `msg_location` should contain</span>
<span class="sd">            references to other objects between braces, the way `location.msg_contents`</span>
<span class="sd">            would allow.  For instance:</span>
<span class="sd">                msg_self = &#39;You say: &quot;{speech}&quot;&#39;</span>
<span class="sd">                msg_location = &#39;{object} says: &quot;{speech}&quot;&#39;</span>
<span class="sd">                msg_receiver = &#39;{object} whispers: &quot;{speech}&quot;&#39;</span>

<span class="sd">            The following mappings can be used in both messages:</span>
<span class="sd">                object: the object speaking.</span>
<span class="sd">                location: the location where object is.</span>
<span class="sd">                speech: the text spoken by self.</span>

<span class="sd">            You can use additional mappings if you want to add other</span>
<span class="sd">            information in your messages.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_say</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;location&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="n">location</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">location</span>
            <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="n">inherits_from</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="s2">&quot;evennia.objects.objects.DefaultRoom&quot;</span><span class="p">)</span>
            <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">location</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;whisper&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="n">location</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">location</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">message</span><span class="p">)</span>

            <span class="c1"># Call the other characters&#39; &quot;say&quot; event</span>
            <span class="n">presents</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">obj</span>
                <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">location</span><span class="o">.</span><span class="n">contents</span>
                <span class="k">if</span> <span class="n">obj</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span>
                <span class="ow">and</span> <span class="n">inherits_from</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="s2">&quot;evennia.objects.objects.DefaultCharacter&quot;</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="k">for</span> <span class="n">present</span> <span class="ow">in</span> <span class="n">presents</span><span class="p">:</span>
                <span class="n">present</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;say&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">present</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">parameters</span><span class="o">=</span><span class="n">message</span><span class="p">)</span></div></div>


<span class="c1"># Exit help</span>
<span class="n">EXIT_CAN_TRAVERSE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Can the character traverse through this exit?</span>
<span class="s2">This event is called when a character is about to traverse this</span>
<span class="s2">exit.  You can use the deny() function to deny the character from</span>
<span class="s2">exitting for this time.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character that wants to traverse this exit.</span>
<span class="s2">    exit: the exit to be traversed.</span>
<span class="s2">    room: the room in which stands the character before moving.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">EXIT_MSG_ARRIVE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Customize the message when a character arrives through this exit.</span>
<span class="s2">This event is called when a character arrives through this exit.</span>
<span class="s2">To customize the message that will be sent to the room where the</span>
<span class="s2">character arrives, change the value of the variable &quot;message&quot;</span>
<span class="s2">to give it your custom message.  The character itself will not be</span>
<span class="s2">notified.  You can use mapping between braces, like this:</span>
<span class="s2">    message = &quot;</span><span class="si">{character}</span><span class="s2"> climbs out of a hole.&quot;</span>
<span class="s2">In your mapping, you can use </span><span class="si">{character}</span><span class="s2"> (the character who has</span>
<span class="s2">arrived), </span><span class="si">{exit}</span><span class="s2"> (the exit), </span><span class="si">{origin}</span><span class="s2"> (the room in which</span>
<span class="s2">the character was), and </span><span class="si">{destination}</span><span class="s2"> (the room in which the character</span>
<span class="s2">now is).  If you need to customize the message with other information,</span>
<span class="s2">you can also set &quot;message&quot; to None and send something else instead.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who is arriving through this exit.</span>
<span class="s2">    exit: the exit having been traversed.</span>
<span class="s2">    origin: the past location of the character.</span>
<span class="s2">    destination: the current location of the character.</span>
<span class="s2">    message: the message to be displayed in the destination.</span>
<span class="s2">    mapping: a dictionary containing the mapping of the message.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">EXIT_MSG_LEAVE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Customize the message when a character leaves through this exit.</span>
<span class="s2">This event is called when a character leaves through this exit.</span>
<span class="s2">To customize the message that will be sent to the room where the</span>
<span class="s2">character came from, change the value of the variable &quot;message&quot;</span>
<span class="s2">to give it your custom message.  The character itself will not be</span>
<span class="s2">notified.  You can use mapping between braces, like this:</span>
<span class="s2">    message = &quot;</span><span class="si">{character}</span><span class="s2"> falls into a hole!&quot;</span>
<span class="s2">In your mapping, you can use </span><span class="si">{character}</span><span class="s2"> (the character who is</span>
<span class="s2">about to leave), </span><span class="si">{exit}</span><span class="s2"> (the exit), </span><span class="si">{origin}</span><span class="s2"> (the room in which</span>
<span class="s2">the character is), and </span><span class="si">{destination}</span><span class="s2"> (the room in which the character</span>
<span class="s2">is heading for).  If you need to customize the message with other</span>
<span class="s2">information, you can also set &quot;message&quot; to None and send something</span>
<span class="s2">else instead.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who is leaving through this exit.</span>
<span class="s2">    exit: the exit being traversed.</span>
<span class="s2">    origin: the location of the character.</span>
<span class="s2">    destination: the destination of the character.</span>
<span class="s2">    message: the message to be displayed in the location.</span>
<span class="s2">    mapping: a dictionary containing additional mapping.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">EXIT_TIME</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">A repeated event to be called regularly.</span>
<span class="s2">This event is scheduled to repeat at different times, specified</span>
<span class="s2">as parameters.  You can set it to run every day at 8:00 AM (game</span>
<span class="s2">time).  You have to specify the time as an argument to @call/add, like:</span>
<span class="s2">    @call/add north = time 8:00</span>
<span class="s2">The parameter (8:00 here) must be a suite of digits separated by</span>
<span class="s2">spaces, colons or dashes.  Keep it as close from a recognizable</span>
<span class="s2">date format, like this:</span>
<span class="s2">    @call/add south = time 06-15 12:20</span>
<span class="s2">This event will fire every year on June the 15th at 12 PM (still</span>
<span class="s2">game time).  Units have to be specified depending on your set calendar</span>
<span class="s2">(ask a developer for more details).</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    exit: the exit connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">EXIT_TRAVERSE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">After the characer has traversed through this exit.</span>
<span class="s2">This event is called after a character has traversed through this</span>
<span class="s2">exit.  Traversing cannot be prevented using &#39;deny()&#39; at this</span>
<span class="s2">point.  The character will be in a different room and she will</span>
<span class="s2">have received the room&#39;s description when this event is called.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who has traversed through this exit.</span>
<span class="s2">    exit: the exit that was just traversed through.</span>
<span class="s2">    origin: the exit&#39;s location (where the character was before moving).</span>
<span class="s2">    destination: the character&#39;s location after moving.</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="EventExit"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventExit">[docs]</a><span class="nd">@register_events</span>
<span class="k">class</span> <span class="nc">EventExit</span><span class="p">(</span><span class="n">DefaultExit</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Modified exit including management of events.&quot;&quot;&quot;</span>

    <span class="n">_events</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;can_traverse&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">EXIT_CAN_TRAVERSE</span><span class="p">),</span>
        <span class="s2">&quot;msg_arrive&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;destination&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">],</span>
            <span class="n">EXIT_MSG_ARRIVE</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;msg_leave&quot;</span><span class="p">:</span> <span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;destination&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">,</span> <span class="s2">&quot;mapping&quot;</span><span class="p">],</span>
            <span class="n">EXIT_MSG_LEAVE</span><span class="p">,</span>
        <span class="p">),</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;exit&quot;</span><span class="p">],</span> <span class="n">EXIT_TIME</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_event</span><span class="p">),</span>
        <span class="s2">&quot;traverse&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;exit&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">EXIT_TRAVERSE</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="EventExit.callbacks"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventExit.callbacks">[docs]</a>    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the CallbackHandler.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CallbackHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventExit.at_traverse"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventExit.at_traverse">[docs]</a>    <span class="k">def</span> <span class="nf">at_traverse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traversing_object</span><span class="p">,</span> <span class="n">target_location</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This hook is responsible for handling the actual traversal,</span>
<span class="sd">        normally by calling</span>
<span class="sd">        `traversing_object.move_to(target_location)`. It is normally</span>
<span class="sd">        only implemented by Exit objects. If it returns False (usually</span>
<span class="sd">        because `move_to` returned False), `at_after_traverse` below</span>
<span class="sd">        should not be called and instead `at_failed_traverse` should be</span>
<span class="sd">        called.</span>

<span class="sd">        Args:</span>
<span class="sd">            traversing_object (Object): Object traversing us.</span>
<span class="sd">            target_location (Object): Where target is going.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">is_character</span> <span class="o">=</span> <span class="n">inherits_from</span><span class="p">(</span><span class="n">traversing_object</span><span class="p">,</span> <span class="n">DefaultCharacter</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_character</span><span class="p">:</span>
            <span class="n">allow</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_traverse&quot;</span><span class="p">,</span> <span class="n">traversing_object</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">allow</span><span class="p">:</span>
                <span class="k">return</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_traverse</span><span class="p">(</span><span class="n">traversing_object</span><span class="p">,</span> <span class="n">target_location</span><span class="p">)</span>

        <span class="c1"># After traversing</span>
        <span class="k">if</span> <span class="n">is_character</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span>
                <span class="s2">&quot;traverse&quot;</span><span class="p">,</span> <span class="n">traversing_object</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">location</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">destination</span>
            <span class="p">)</span></div></div>


<span class="c1"># Object help</span>
<span class="n">OBJECT_DROP</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">When a character drops this object.</span>
<span class="s2">This event is called when a character drops this object.  It is</span>
<span class="s2">called after the command has ended and displayed its message, and</span>
<span class="s2">the action cannot be prevented at this time.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character having dropped the object.</span>
<span class="s2">    obj: the object connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">OBJECT_GET</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">When a character gets this object.</span>
<span class="s2">This event is called when a character gets this object.  It is</span>
<span class="s2">called after the command has ended and displayed its message, and</span>
<span class="s2">the action cannot be prevented at this time.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character having picked up the object.</span>
<span class="s2">    obj: the object connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">OBJECT_TIME</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">A repeated event to be called regularly.</span>
<span class="s2">This event is scheduled to repeat at different times, specified</span>
<span class="s2">as parameters.  You can set it to run every day at 8:00 AM (game</span>
<span class="s2">time).  You have to specify the time as an argument to @call/add, like:</span>
<span class="s2">    @call/add here = time 8:00</span>
<span class="s2">The parameter (8:00 here) must be a suite of digits separated by</span>
<span class="s2">spaces, colons or dashes.  Keep it as close from a recognizable</span>
<span class="s2">date format, like this:</span>
<span class="s2">    @call/add here = time 06-15 12:20</span>
<span class="s2">This event will fire every year on June the 15th at 12 PM (still</span>
<span class="s2">game time).  Units have to be specified depending on your set calendar</span>
<span class="s2">(ask a developer for more details).</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    object: the object connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="EventObject"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventObject">[docs]</a><span class="nd">@register_events</span>
<span class="k">class</span> <span class="nc">EventObject</span><span class="p">(</span><span class="n">DefaultObject</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Default object with management of events.&quot;&quot;&quot;</span>

    <span class="n">_events</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;drop&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;obj&quot;</span><span class="p">],</span> <span class="n">OBJECT_DROP</span><span class="p">),</span>
        <span class="s2">&quot;get&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;obj&quot;</span><span class="p">],</span> <span class="n">OBJECT_GET</span><span class="p">),</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;object&quot;</span><span class="p">],</span> <span class="n">OBJECT_TIME</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_event</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="EventObject.callbacks"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventObject.callbacks">[docs]</a>    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the CallbackHandler.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CallbackHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventObject.at_get"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventObject.at_get">[docs]</a>    <span class="k">def</span> <span class="nf">at_get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">getter</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by the default `get` command when this object has been</span>
<span class="sd">        picked up.</span>

<span class="sd">        Args:</span>
<span class="sd">            getter (Object): The object getting this object.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This hook cannot stop the pickup from happening. Use</span>
<span class="sd">            permissions for that.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_get</span><span class="p">(</span><span class="n">getter</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;get&quot;</span><span class="p">,</span> <span class="n">getter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventObject.at_drop"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventObject.at_drop">[docs]</a>    <span class="k">def</span> <span class="nf">at_drop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dropper</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called by the default `drop` command when this object has been</span>
<span class="sd">        dropped.</span>

<span class="sd">        Args:</span>
<span class="sd">            dropper (Object): The object which just dropped this object.</span>

<span class="sd">        Notes:</span>
<span class="sd">            This hook cannot stop the drop from happening. Use</span>
<span class="sd">            permissions from that.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">at_drop</span><span class="p">(</span><span class="n">dropper</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;drop&quot;</span><span class="p">,</span> <span class="n">dropper</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span></div></div>


<span class="c1"># Room help</span>
<span class="n">ROOM_CAN_DELETE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Can the room be deleted?</span>
<span class="s2">This event is called before the room is deleted.  You can use</span>
<span class="s2">&#39;deny()&#39; in this event to prevent this room from being deleted.</span>
<span class="s2">If this event doesn&#39;t prevent the room from being deleted, its</span>
<span class="s2">&#39;delete&#39; event is called right away.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_CAN_MOVE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Can the character move into this room?</span>
<span class="s2">This event is called before the character can move into this</span>
<span class="s2">specific room.  You can prevent the move by using the &#39;deny()&#39;</span>
<span class="s2">function.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who wants to move in this room.</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_CAN_SAY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Before a character can say something in this room.</span>
<span class="s2">This event is called before a character says something in this</span>
<span class="s2">room.  The &quot;something&quot; in question can be modified, or the action</span>
<span class="s2">can be prevented by using &#39;deny()&#39;.  To change the content of what</span>
<span class="s2">the character says, simply change the variable &#39;message&#39; to another</span>
<span class="s2">string of characters.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who is using the say command.</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">    message: the text spoken by the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_DELETE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Before deleting the room.</span>
<span class="s2">This event is called just before deleting this room.  It shouldn&#39;t</span>
<span class="s2">be prevented (using the `deny()` function at this stage doesn&#39;t</span>
<span class="s2">have any effect).  If you want to prevent deletion of this room,</span>
<span class="s2">use the event `can_delete` instead.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_MOVE</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">After the character has moved into this room.</span>
<span class="s2">This event is called when the character has moved into this</span>
<span class="s2">room.  It is too late to prevent the move at this point.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character connected to this event.</span>
<span class="s2">    origin: the old location of the character.</span>
<span class="s2">    destination: the new location of the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_PUPPETED_IN</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">After the character has been puppeted in this room.</span>
<span class="s2">This event is called after a character has been puppeted in this</span>
<span class="s2">room.  This can happen when an account, having connected, begins</span>
<span class="s2">to puppet a character.  The character&#39;s location at this point,</span>
<span class="s2">if it&#39;s a room, will see this event fire.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who have just been puppeted in this room.</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_SAY</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">After the character has said something in the room.</span>
<span class="s2">This event is called right after a character has said something</span>
<span class="s2">in this room.  The action cannot be prevented at this moment.</span>
<span class="s2">Instead, this event is ideal to create actions that will respond</span>
<span class="s2">to something being said aloud.  To use this event, you have to</span>
<span class="s2">specify a list of keywords as parameters that should be present,</span>
<span class="s2">as separate words, in the spoken phrase.  For instance, you can</span>
<span class="s2">set an event tthat would fire if the phrase spoken by the character</span>
<span class="s2">contains &quot;menu&quot; or &quot;dinner&quot; or &quot;lunch&quot;:</span>
<span class="s2">    @call/add ... = say menu, dinner, lunch</span>
<span class="s2">Then if one of the words is present in what the character says,</span>
<span class="s2">this event will fire.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character having spoken in this room.</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">    message: the text having been spoken by the character.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_TIME</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">A repeated event to be called regularly.</span>
<span class="s2">This event is scheduled to repeat at different times, specified</span>
<span class="s2">as parameters.  You can set it to run every day at 8:00 AM (game</span>
<span class="s2">time).  You have to specify the time as an argument to @call/add, like:</span>
<span class="s2">    @call/add here = time 8:00</span>
<span class="s2">The parameter (8:00 here) must be a suite of digits separated by</span>
<span class="s2">spaces, colons or dashes.  Keep it as close from a recognizable</span>
<span class="s2">date format, like this:</span>
<span class="s2">    @call/add here = time 06-15 12:20</span>
<span class="s2">This event will fire every year on June the 15th at 12 PM (still</span>
<span class="s2">game time).  Units have to be specified depending on your set calendar</span>
<span class="s2">(ask a developer for more details).</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">ROOM_UNPUPPETED_IN</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">Before the character is un-puppeted in this room.</span>
<span class="s2">This event is called before a character is un-puppeted in this</span>
<span class="s2">room.  This can happen when an account, puppeting a character, is</span>
<span class="s2">disconnecting.  The character&#39;s location at this point, if it&#39;s a</span>
<span class="s2">room, will see this event fire.</span>

<span class="s2">Variables you can use in this event:</span>
<span class="s2">    character: the character who is about to be un-puppeted in this room.</span>
<span class="s2">    room: the room connected to this event.</span>
<span class="s2">&quot;&quot;&quot;</span>


<div class="viewcode-block" id="EventRoom"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventRoom">[docs]</a><span class="nd">@register_events</span>
<span class="k">class</span> <span class="nc">EventRoom</span><span class="p">(</span><span class="n">DefaultRoom</span><span class="p">):</span>

    <span class="sd">&quot;&quot;&quot;Default room with management of events.&quot;&quot;&quot;</span>

    <span class="n">_events</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;can_delete&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">ROOM_CAN_DELETE</span><span class="p">),</span>
        <span class="s2">&quot;can_move&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">ROOM_CAN_MOVE</span><span class="p">),</span>
        <span class="s2">&quot;can_say&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;room&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">ROOM_CAN_SAY</span><span class="p">,</span> <span class="n">phrase_event</span><span class="p">),</span>
        <span class="s2">&quot;delete&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">ROOM_DELETE</span><span class="p">),</span>
        <span class="s2">&quot;move&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;origin&quot;</span><span class="p">,</span> <span class="s2">&quot;destination&quot;</span><span class="p">],</span> <span class="n">ROOM_MOVE</span><span class="p">),</span>
        <span class="s2">&quot;puppeted_in&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">ROOM_PUPPETED_IN</span><span class="p">),</span>
        <span class="s2">&quot;say&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;room&quot;</span><span class="p">,</span> <span class="s2">&quot;message&quot;</span><span class="p">],</span> <span class="n">ROOM_SAY</span><span class="p">,</span> <span class="n">phrase_event</span><span class="p">),</span>
        <span class="s2">&quot;time&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">ROOM_TIME</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">time_event</span><span class="p">),</span>
        <span class="s2">&quot;unpuppeted_in&quot;</span><span class="p">:</span> <span class="p">([</span><span class="s2">&quot;character&quot;</span><span class="p">,</span> <span class="s2">&quot;room&quot;</span><span class="p">],</span> <span class="n">ROOM_UNPUPPETED_IN</span><span class="p">),</span>
    <span class="p">}</span>

<div class="viewcode-block" id="EventRoom.callbacks"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventRoom.callbacks">[docs]</a>    <span class="nd">@lazy_property</span>
    <span class="k">def</span> <span class="nf">callbacks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Return the CallbackHandler.&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">CallbackHandler</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></div>

<div class="viewcode-block" id="EventRoom.at_object_delete"><a class="viewcode-back" href="../../../../api/evennia.contrib.ingame_python.html#evennia.contrib.ingame_python.typeclasses.EventRoom.at_object_delete">[docs]</a>    <span class="k">def</span> <span class="nf">at_object_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Called just before the database object is permanently</span>
<span class="sd">        delete()d from the database. If this method returns False,</span>
<span class="sd">        deletion is aborted.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;can_delete&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">):</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">callbacks</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="s2">&quot;delete&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">True</span></div></div>
</pre></div>

           </div>
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, The Evennia developer community.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> and ❤️  using a custom <a href="https://github.com/LinxiFan/Sphinx-theme">theme</a> based on <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../../../',
            VERSION:'1.0-dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../../../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../../../_static/doctools.js"></script>
      <script type="text/javascript" src="../../../../_static/language_data.js"></script>

  

  
  
    <script type="text/javascript" src="../../../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>