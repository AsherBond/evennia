
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Adding Object Typeclass Tutorial &#8212; Evennia 0.9.5 documentation</title>
    <link rel="stylesheet" href="_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"processClass": "tex2jax_process|mathjax_process|math|output_area"}})</script>
    <link rel="shortcut icon" href="_static/favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Evennia 0.9.5</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Adding Object Typeclass Tutorial</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section class="tex2jax_ignore mathjax_ignore" id="adding-object-typeclass-tutorial">
<h1>Adding Object Typeclass Tutorial<a class="headerlink" href="#adding-object-typeclass-tutorial" title="Permalink to this headline">¶</a></h1>
<p>Evennia comes with a few very basic classes of in-game entities:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>DefaultObject
   |
   DefaultCharacter
   DefaultRoom
   DefaultExit
   DefaultChannel
</pre></div>
</div>
<p>When you create a new Evennia game (with for example <code class="docutils literal notranslate"><span class="pre">evennia</span> <span class="pre">--init</span> <span class="pre">mygame</span></code>) Evennia will
automatically create empty child classes <code class="docutils literal notranslate"><span class="pre">Object</span></code>, <code class="docutils literal notranslate"><span class="pre">Character</span></code>, <code class="docutils literal notranslate"><span class="pre">Room</span></code> and <code class="docutils literal notranslate"><span class="pre">Exit</span></code> respectively. They
are found <code class="docutils literal notranslate"><span class="pre">mygame/typeclasses/objects.py</span></code>, <code class="docutils literal notranslate"><span class="pre">mygame/typeclasses/rooms.py</span></code> etc.</p>
<blockquote>
<div><p>Technically these are all <a class="reference internal" href="Typeclasses.html"><span class="doc std std-doc">Typeclassed</span></a>, which can be ignored for now. In
<code class="docutils literal notranslate"><span class="pre">mygame/typeclasses</span></code> are also base typeclasses for out-of-character things, notably
<a class="reference internal" href="Communications.html"><span class="doc std std-doc">Channels</span></a>, <a class="reference internal" href="Accounts.html"><span class="doc std std-doc">Accounts</span></a> and <a class="reference internal" href="Scripts.html"><span class="doc std std-doc">Scripts</span></a>. We don’t cover those in
this tutorial.</p>
</div></blockquote>
<p>For your own game you will most likely want to expand on these very simple beginnings. It’s normal
to want your Characters to have various attributes, for example. Maybe Rooms should hold extra
information or even <em>all</em> Objects in your game should have properties not included in basic Evennia.</p>
<section id="change-default-rooms-exits-character-typeclass">
<h2>Change Default Rooms, Exits, Character Typeclass<a class="headerlink" href="#change-default-rooms-exits-character-typeclass" title="Permalink to this headline">¶</a></h2>
<p>This is the simplest case.</p>
<p>The default build commands of a new Evennia game is set up to use the <code class="docutils literal notranslate"><span class="pre">Room</span></code>, <code class="docutils literal notranslate"><span class="pre">Exit</span></code> and <code class="docutils literal notranslate"><span class="pre">Character</span></code>
classes found in the same-named modules under <code class="docutils literal notranslate"><span class="pre">mygame/typeclasses/</span></code>. By default these are empty and
just implements the default parents from the Evennia library (<code class="docutils literal notranslate"><span class="pre">DefaultRoom</span></code>etc). Just add the
changes you want to these classes and run <code class="docutils literal notranslate"><span class="pre">&#64;reload</span></code> to add your new functionality.</p>
</section>
<section id="create-a-new-type-of-object">
<h2>Create a new type of object<a class="headerlink" href="#create-a-new-type-of-object" title="Permalink to this headline">¶</a></h2>
<p>Say you want to create a new “Heavy” object-type that characters should not have the ability to pick
up.</p>
<ol class="simple">
<li><p>Edit <code class="docutils literal notranslate"><span class="pre">mygame/typeclasses/objects.py</span></code> (you could also create a new module there, named something
like <code class="docutils literal notranslate"><span class="pre">heavy.py</span></code>, that’s up to how you want to organize things).</p></li>
<li><p>Create a new class inheriting at any distance from <code class="docutils literal notranslate"><span class="pre">DefaultObject</span></code>. It could look something like
this:</p></li>
</ol>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="c1"># end of file mygame/typeclasses/objects.py</span>
    <span class="kn">from</span> <span class="nn">evennia</span> <span class="kn">import</span> <span class="n">DefaultObject</span>
    
    <span class="k">class</span> <span class="nc">Heavy</span><span class="p">(</span><span class="n">DefaultObject</span><span class="p">):</span>
       <span class="s2">&quot;Heavy object&quot;</span>
       <span class="k">def</span> <span class="nf">at_object_creation</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
           <span class="s2">&quot;Called whenever a new object is created&quot;</span>
           <span class="c1"># lock the object down by default</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">locks</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;get:false()&quot;</span><span class="p">)</span>
           <span class="c1"># the default &quot;get&quot; command looks for this Attribute in order</span>
           <span class="c1"># to return a customized error message (we just happen to know</span>
           <span class="c1"># this, you&#39;d have to look at the code of the &#39;get&#39; command to</span>
           <span class="c1"># find out).</span>
           <span class="bp">self</span><span class="o">.</span><span class="n">db</span><span class="o">.</span><span class="n">get_err_msg</span> <span class="o">=</span> <span class="s2">&quot;This is too heavy to pick up.&quot;</span>
</pre></div>
</div>
<ol class="simple">
<li><p>Once you are done, log into the game with a build-capable account and do <code class="docutils literal notranslate"><span class="pre">&#64;create/drop</span> <span class="pre">rock:objects.Heavy</span></code> to drop a new heavy “rock” object in your location. Next try to pick it up
(<code class="docutils literal notranslate"><span class="pre">&#64;quell</span></code> yourself first if you are a superuser). If you get errors, look at your log files where
you will find the traceback. The most common error is that you have some sort of syntax error in
your class.</p></li>
</ol>
<p>Note that the <a class="reference internal" href="Locks.html"><span class="doc std std-doc">Locks</span></a> and <a class="reference internal" href="Attributes.html"><span class="doc std std-doc">Attribute</span></a> which are set in the typeclass could just
as well have been set using commands in-game, so this is a <em>very</em> simple example.</p>
</section>
<section id="storing-data-on-initialization">
<h2>Storing data on initialization<a class="headerlink" href="#storing-data-on-initialization" title="Permalink to this headline">¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">at_object_creation</span></code> is only called once, when the object is first created. This makes it ideal
for database-bound things like <a class="reference internal" href="Attributes.html"><span class="doc std std-doc">Attributes</span></a>. But sometimes you want to create temporary
properties (things that are not to be stored in the database but still always exist every time the
object is created). Such properties can be initialized in the <code class="docutils literal notranslate"><span class="pre">at_init</span></code> method on the object.
<code class="docutils literal notranslate"><span class="pre">at_init</span></code> is called every time the object is loaded into memory.</p>
<blockquote>
<div><p>Note: It’s usually pointless and wasteful to assign database data in <code class="docutils literal notranslate"><span class="pre">at_init</span></code>, since this will
hit the database with the same value over and over. Put those in <code class="docutils literal notranslate"><span class="pre">at_object_creation</span></code> instead.</p>
</div></blockquote>
<p>You are wise to use <code class="docutils literal notranslate"><span class="pre">ndb</span></code> (non-database Attributes) to store these non-persistent properties, since
ndb-properties are protected against being cached out in various ways and also allows you to list
them using various in-game tools:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">at_init</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">ndb</span><span class="o">.</span><span class="n">mylist</span> <span class="o">=</span> <span class="p">[]</span>
</pre></div>
</div>
<blockquote>
<div><p>Note: As mentioned in the <a class="reference internal" href="Typeclasses.html"><span class="doc std std-doc">Typeclasses</span></a> documentation, <code class="docutils literal notranslate"><span class="pre">at_init</span></code> replaces the use of
the standard <code class="docutils literal notranslate"><span class="pre">__init__</span></code> method of typeclasses due to how the latter may be called in situations
other than you’d expect. So use <code class="docutils literal notranslate"><span class="pre">at_init</span></code> where you would normally use <code class="docutils literal notranslate"><span class="pre">__init__</span></code>.</p>
</div></blockquote>
</section>
<section id="updating-existing-objects">
<h2>Updating existing objects<a class="headerlink" href="#updating-existing-objects" title="Permalink to this headline">¶</a></h2>
<p>If you already have some <code class="docutils literal notranslate"><span class="pre">Heavy</span></code> objects created and you add a new <code class="docutils literal notranslate"><span class="pre">Attribute</span></code> in
<code class="docutils literal notranslate"><span class="pre">at_object_creation</span></code>, you will find that those existing objects will not have this Attribute. This
is not so strange, since <code class="docutils literal notranslate"><span class="pre">at_object_creation</span></code> is only called once, it will not be called again just
because you update it. You need to update existing objects manually.</p>
<p>If the number of objects is limited, you can use <code class="docutils literal notranslate"><span class="pre">&#64;typeclass/force/reload</span> <span class="pre">objectname</span></code> to force a
re-load of the <code class="docutils literal notranslate"><span class="pre">at_object_creation</span></code> method (only) on the object. This case is common enough that
there is an alias <code class="docutils literal notranslate"><span class="pre">&#64;update</span> <span class="pre">objectname</span></code> you can use to get the same effect. If there are multiple
objects you can use <code class="docutils literal notranslate"><span class="pre">&#64;py</span></code> to loop over the objects you need:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@py</span> <span class="kn">from</span> <span class="nn">typeclasses.objects</span> <span class="kn">import</span> <span class="n">Heavy</span><span class="p">;</span> <span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">at_object_creation</span><span class="p">()</span> <span class="k">for</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">Heavy</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">()]</span>

</pre></div>
</div>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/evennia_logo.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<p><h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Adding Object Typeclass Tutorial</a><ul>
<li><a class="reference internal" href="#change-default-rooms-exits-character-typeclass">Change Default Rooms, Exits, Character Typeclass</a></li>
<li><a class="reference internal" href="#create-a-new-type-of-object">Create a new type of object</a></li>
<li><a class="reference internal" href="#storing-data-on-initialization">Storing data on initialization</a></li>
<li><a class="reference internal" href="#updating-existing-objects">Updating existing objects</a></li>
</ul>
</li>
</ul>

  <div role="note" aria-label="source link">
    <!--h3>This Page</h3-->
    <ul class="this-page-menu">
      <li><a href="_sources/Adding-Object-Typeclass-Tutorial.md.txt"
            rel="nofollow">Show Page Source</a></li>
    </ul>
   </div><h3>Links</h3>
<ul>
  <li><a href="https://www.evennia.com">Home page</a> </li>
  <li><a href="https://github.com/evennia/evennia">Evennia Github</a> </li>
  <li><a href="http://games.evennia.com">Game Index</a> </li>
  <li>
    <a href="https://discord.gg/AJJpcRUhtF">Discord</a> -
     <a href="https://github.com/evennia/evennia/discussions">Discussions</a> -
      <a href="https://evennia.blogspot.com/">Blog</a>
  </li>
</ul>
<h3>Versions</h3>
<ul>
  <li><a href="../1.0-dev/index.html">1.0-dev (develop branch)</a></li>
  <li><a href="Adding-Object-Typeclass-Tutorial.html">0.9.5 (v0.9.5 branch)</a></li>
</ul>

        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="index.html">Evennia 0.9.5</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Adding Object Typeclass Tutorial</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2020, The Evennia developer community.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>